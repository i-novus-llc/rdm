<?xml version='1.0' encoding='UTF-8'?>
<simple-page xmlns="http://n2oapp.net/framework/config/schema/page-2.0" name="Структура">
    <form default-values-query-id="versionDefault" query-id="attribute" object-id="attribute">
        <fields>
            <input-text id="code" label="Код" required="true">
                <dependencies>
                    <enabling>typeof id == 'undefined'</enabling>
                </dependencies>
            </input-text>

            <input-text id="name" label="Наименование" required="true"/>

            <select id="attrType" label="Тип" required="true" label-field-id="name">
                <options>
                    <option id="STRING" name="Строковый"/>
                    <option id="INTEGER" name="Целочисленный"/>
                    <option id="FLOAT" name="Дробный"/>
                    <option id="DATE" name="Дата"/>
                    <option id="BOOLEAN" name="Логический"/>
<!--                    <option id="REFERENCE" name="Ссылочный"/>-->
                </options>
            </select>

            <input-select id="referenceRefBook" label="Выбор справочника"
                          query-id="refBook" label-field-id="displayCode">
                <dependencies>
                    <visibility on="attrType">
                        attrType.id == 'REFERENCE'
                    </visibility>
                </dependencies>
                <pre-filters>
                    <eq field-id="hasPublishedVersion" value="true" />
                </pre-filters>
                <validations>
                    <condition id="hasRefBook" severity="danger"
                               message="Справочник не выбран">
                        referenceRefBook != null
                    </condition>
                    <condition id="hasPrimaryAttribute" severity="danger"
                               message="У справочника нет первичного ключа">
                        referenceRefBook.hasPrimaryAttribute
                    </condition>
                </validations>
            </input-select>
            
            <radio-group id="displayType" no-label="true">
                <options>
                    <option id="1" name="Обычный формат"/>
                    <option id="2" name="Задать формат"/>
                </options>
                <dependencies>
                    <visibility on="attrType,referenceRefBook">
                        (attrType.id == 'REFERENCE' &amp;&amp; referenceRefBook != null)
                    </visibility>
                </dependencies>
            </radio-group>

<!--            <hidden id="displayType" default-value="1"/>-->
<!--            <input-text id="displayType"/>-->
<!--            <input-text id="displayType" default-value="1"/>-->

            <select id="displayAttribute" label="Отображаемый атрибут"
                          query-id="attribute" label-field-id="name" cleanable="false">
<!--                <toolbar>-->
<!--                    <button id="toDisplayExpression" label="Задать формат" model="edit">-->
<!--                        <set-value target-field-id="displayType">-->
<!--                            return 2;-->
<!--                        </set-value>-->
<!--                    </button>-->
<!--                </toolbar>-->
                <dependencies>
                    <visibility on="attrType,referenceRefBook,displayType">
                        (attrType.id == 'REFERENCE' &amp;&amp; referenceRefBook != null &amp;&amp; displayType.id != 2)
                    </visibility>
                </dependencies>
                <pre-filters>
                    <eq field-id="versionId" value="{referenceRefBook.version.id}" />
                </pre-filters>
            </select>

            <input-text id="displayExpression" label="Отображаемое поле">
<!--                <toolbar>-->
<!--                    <button id="toDisplayAttribute" label="Обычный формат">-->
<!--                        <set-value model="edit" target-field-id="displayType">-->
<!--                            return 1;-->
<!--                        </set-value>-->
<!--                    </button>-->
<!--                </toolbar>-->
                <dependencies>
                    <visibility on="attrType,referenceRefBook,displayType">
                        (attrType.id == 'REFERENCE' &amp;&amp; referenceRefBook != null &amp;&amp; displayType.id == 2)
                    </visibility>
                    <set-value on="displayAttribute">
                        if (displayAttribute.codeExpression != null)
                            return displayAttribute.codeExpression;
                    </set-value>
                </dependencies>
            </input-text>

            <checkbox id="isPrimary" label="Первичный ключ">
                <dependencies>
                    <enabling on="attrType">
                        (attrType != null &amp;&amp; attrType.id != 'BOOLEAN')
                    </enabling>
                </dependencies>
            </checkbox>

            <text-area id="description" label="Описание" rows="2"/>

            <!-- Пользовательские проверки -->

            <checkbox id="required" label="Обязательный атрибут">
                <dependencies>
                    <visibility on="attrType,isPrimary">
                        (attrType != null &amp;&amp; attrType.id != 'BOOLEAN' &amp;&amp; !isPrimary)
                    </visibility>
                    <set-value on="isPrimary">
                        if (isPrimary) return false; else return;
                    </set-value>
                </dependencies>
            </checkbox>

            <checkbox id="unique" label="Уникальный атрибут">
                <dependencies>
                    <visibility on="attrType,isPrimary">
                        (attrType != null &amp;&amp; attrType.id != 'BOOLEAN' &amp;&amp; !isPrimary)
                    </visibility>
                    <set-value on="isPrimary">
                        if (isPrimary) return false; else return;
                    </set-value>
                </dependencies>
            </checkbox>

            <input-text id="plainSize" domain="integer" label="Максимальная длина" min="1">
                <dependencies>
                    <visibility on="attrType">
                        attrType.id == 'STRING' || attrType.id == 'INTEGER'
                    </visibility>
                </dependencies>
            </input-text>
            <row>
                <input-text id="intPartSize" domain="integer" label="Максимальная длина целой части" min="1">
                    <dependencies>
                        <visibility on="attrType">
                            attrType.id == 'FLOAT'
                        </visibility>
                    </dependencies>
                </input-text>
                <input-text id="fracPartSize" domain="integer" label="Максимальная длина дробной части" min="1">
                    <dependencies>
                        <visibility on="attrType">
                            attrType.id == 'FLOAT'
                        </visibility>
                    </dependencies>
                </input-text>
            </row>

            <row>
                <input-text id="minInteger" domain="integer" label="Минимальное значение">
                    <dependencies>
                        <visibility on="attrType">
                            attrType.id == 'INTEGER'
                        </visibility>
                    </dependencies>
                </input-text>
                <input-text id="maxInteger" domain="integer" label="Максимальное значение">
                    <dependencies>
                        <visibility on="attrType">
                            attrType.id == 'INTEGER'
                        </visibility>
                    </dependencies>
                </input-text>
            </row>
            <row>
                <input-text id="minFloat" domain="numeric" label="Минимальное значение">
                    <dependencies>
                        <visibility on="attrType">
                            attrType.id == 'FLOAT'
                        </visibility>
                    </dependencies>
                </input-text>
                <input-text id="maxFloat" domain="numeric" label="Максимальное значение">
                    <dependencies>
                        <visibility on="attrType">
                            attrType.id == 'FLOAT'
                        </visibility>
                    </dependencies>
                </input-text>
            </row>
            <row>
                <date-interval id="dateInterval" label="Интервал значений">
                    <dependencies>
                        <visibility on="attrType">
                            attrType.id == 'DATE'
                        </visibility>
                    </dependencies>
                </date-interval>
            </row>
            <input-text id="regExp" domain="string" label="Регулярное выражение">
                <dependencies>
                    <visibility on="attrType">
                        attrType.id == 'STRING'
                    </visibility>
                </dependencies>
            </input-text>

            <!-- / Пользовательские проверки -->

        </fields>
    </form>
</simple-page>
