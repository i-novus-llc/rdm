<?xml version='1.0' encoding='UTF-8'?>
<page xmlns="http://n2oapp.net/framework/config/schema/page-2.0" name="Реестр НСИ">
    <regions>
        <region place="single">
            <form id="version_select" query-id="refBookVersion">
                <fields>
                    <!-- Поля для передачи динамичных атрибутов из versionList при редактировании записи -->
                    <!-- NB: Used as master-field-id="id" in depends-on="version_select" ? -->
                    <row>
                        <output-text id="id">
                            <dependencies>
                                <set-value on="version">version.id</set-value>
                            </dependencies>
                        </output-text>

                        <output-text id="optLockValue">
                            <dependencies>
                                <set-value on="version">version.optLockValue</set-value>
                            </dependencies>
                        </output-text>
                    </row>

                    <row>
                        <select id="version" label="Версия" cleanable="false"
                                query-id="versionList" label-field-id="version">
                            <pre-filters>
                                <eq field-id="refBookId" value="{refBookId}"/>
                            </pre-filters>

                            <!-- NB: Реализовать единую точку перехода в режим редактирования -->
                            <validations>
                                <condition id="refBookHasDraft" severity="warning"
                                           message="Справочник содержит неопубликованную версию">
                                    (draftVersionId == null || version.id == draftVersionId)
                                </condition>
                                <condition id="isNotLastPublished" severity="warning"
                                           message="Выбранная версия справочника не является последней опубликованной версией">
                                    (version.id == draftVersionId || version.id == lastPublishedVersionId)
                                </condition>
                            </validations>
                        </select>

                        <select id="localeCode" no-label="true" depends-on="version_select"
                                query-id="versionLocaleList" label-field-id="name">
                            <pre-filters>
                                <eq field-id="versionId" value="{version.id}"/>
                            </pre-filters>

                            <dependencies>
                                <visibility>return ${rdm.l10n.support}</visibility>
                                <set-value on="version">version.localeCode.id</set-value>
                            </dependencies>
                        </select>
                    </row>
                </fields>
            </form>
        </region>
    </regions>
</page>