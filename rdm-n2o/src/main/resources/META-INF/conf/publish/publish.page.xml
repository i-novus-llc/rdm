<?xml version='1.0' encoding='UTF-8'?>
<simple-page xmlns="http://n2oapp.net/framework/config/schema/page-2.0" name="Публикация справочника">
    <form object-id="publish" default-values-query-id="publish">

        <pre-filters>
            <eq field-id="version.id" param="versionId"/>
            <eq field-id="version.optLockValue" param="optLockValue"/>
        </pre-filters>

        <fields>
            <row>
                <output-text id="version.id" label="id" visible="false"/>
                <output-text id="version.optLockValue" label="optLockValue" visible="false"/>
            </row>
            <output-text id="version.version" no-label-block="true" visible="false"/>

            <output-text id="errorMessage" class="alert alert-danger" no-label="true">
                <dependencies>
                    <visibility>hasErrorMessage</visibility>
                </dependencies>
            </output-text>

            <output-text id="listCheckDeletedConflictReferrers" label-class="alert alert-warning"
                         label="Были удалены строки, на которые ссылались справочники системы:">
                <dependencies>
                    <visibility>hasCheckDeletedConflicts</visibility>
                </dependencies>
            </output-text>

            <output-text id="listCheckUpdatedConflictReferrers" label-class="alert alert-warning"
                         label="Были изменены строки, на которые ссылались справочники системы:">
                <dependencies>
                    <visibility>hasCheckUpdatedConflicts</visibility>
                </dependencies>
            </output-text>

            <output-text id="listCheckAlteredConflictReferrers" label-class="alert alert-warning"
                         label="Была изменена структура справочника, на который ссылаются справочники системы:">
                <dependencies>
                    <visibility>hasCheckAlteredConflicts &amp;&amp; !hasCheckDisplayDamagedConflicts</visibility>
                </dependencies>
            </output-text>

            <output-text id="listCheckDisplayDamagedConflictReferrers" label-class="alert alert-warning"
                         label="Была изменена структура справочника, публикация новой версии нарушит работу ссылок справочников системы.">
                <dependencies>
                    <visibility>hasCheckDisplayDamagedConflicts</visibility>
                </dependencies>
            </output-text>

            <output-text id="confirmPublish"
                         label="Вы уверены, что хотите опубликовать этот справочник?">
                <dependencies>
                    <visibility>!hasErrorMessage</visibility>
                </dependencies>
            </output-text>

        </fields>

        <toolbar place="bottomRight">
            <button id="publishDraft" label="Опубликовать"
                    visibility-condition="isPublishable">
                <invoke operation-id="publishDraft" close-after-success="true"
                        redirect-target="application" redirect-url="${rdm.context-path}/main"/>
            </button>

            <button id="publishAndRefresh" label="Опубликовать и обновить ссылки"
                    visibility-condition="isPublishable &amp;&amp; (hasCheckUpdatedConflicts || hasCheckAlteredConflicts)">
                <invoke operation-id="publishAndRefresh" close-after-success="true"
                        redirect-target="application" redirect-url="${rdm.context-path}/main"/>
            </button>

            <button id="cancel" label="Отмена">
                <close/>
            </button>

        </toolbar>

    </form>
</simple-page>
