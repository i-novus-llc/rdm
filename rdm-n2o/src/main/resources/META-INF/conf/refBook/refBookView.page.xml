<?xml version='1.0' encoding='UTF-8'?>
<page xmlns="http://n2oapp.net/framework/config/schema/page-2.0" name="Реестр НСИ">
    <regions>
        <region place="single">
            <form id="version_select" query-id="refBookVersion">
                <pre-filters>
                    <eq field-id="refBookId" param="refBookId"/>
                </pre-filters>
                <fields>
                    <!-- Поля для передачи динамичных атрибутов из versionList при редактировании записи -->
                    <!-- NB: Used as master-field-id="id" in depends-on="version_select" ? -->
                    <output-text id="id" visible="false">
                        <dependencies>
                            <set-value on="version">version.id</set-value>
                        </dependencies>
                    </output-text>

                    <row>
                        <select id="version" label="Версия" query-id="versionList" label-field-id="version"
                                cleanable="false">
                            <pre-filters>
                                <eq field-id="refBookId" value="{refBookId}"/>
                            </pre-filters>
                        </select>

                        <select id="localeCode" no-label="true" depends-on="version_select"
                                query-id="versionLocaleList" label-field-id="name">
                            <pre-filters>
                                <eq field-id="versionId" value="{version.id}"/>
                            </pre-filters>

                            <dependencies>
                                <visibility>return ${rdm.l10n.support}</visibility>
                                <set-value on="version">version.localeCode.id</set-value>
                            </dependencies>
                        </select>
                    </row>
                </fields>

                <toolbar place="bottomLeft">
                    <button label="Скачать">
                        <show-modal page-id="downloadFile" upload="defaults">
                            <pre-filters>
                                <eq field-id="versionId" value="{version.id}"/>
                            </pre-filters>
                        </show-modal>
                    </button>
                </toolbar>
            </form>
        </region>

        <tabs place="single">
            <form ref-id="passportView" name="Паспорт" id="passport_form"
                  depends-on="version_select" fetch-on-init="true"
                  master-field-id="id" detail-field-id="version.id" object-id="refBook"/>

            <table ref-id="structure" name="Структура" id="structure_table"
                   depends-on="version_select" fetch-on-init="true"
                   master-field-id="id" detail-field-id="versionId" upload="query"/>

            <table src="DataGrid" name="Данные" id="dataTable"
                   query-id="data" depends-on="version_select" fetch-on-init="true"
                   master-field-id="id" detail-field-id="versionId" object-id="data">
                <pre-filters>
                    <eq field-id="localeCode" value=""/>
                </pre-filters>
            </table>

            <table src="DataGrid" name="Переведённые данные" id="dataTableWithLocales"
                   query-id="data" depends-on="version_select" fetch-on-init="true"
                   master-field-id="id" detail-field-id="versionId" object-id="data"
                   visible="{${rdm.l10n.support}}">
                <pre-filters>
                    <eq field-id="localeCode" value="{localeCode.id}" ref-model="resolve"
                        ref-widget-id="version_select"/>
                </pre-filters>
            </table>

            <table src="DataGrid" name="Данные с конфликтами" id="dataTableWithConflicts"
                   query-id="data" depends-on="version_select" fetch-on-init="true"
                   master-field-id="id" detail-field-id="versionId" object-id="data">
                <pre-filters>
                    <eq field-id="hasDataConflict" value="true"/>
                </pre-filters>
            </table>
        </tabs>
    </regions>

</page>
